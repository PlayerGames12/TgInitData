<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Telegram WebApp Cache Test</title>
  <script>
    // Текущая версия приложения (меняйте при каждом обновлении)
    const APP_VERSION = '1.0.1';
    
    // Проверка и сброс кэша при необходимости
    function checkCache() {
      const cachedVersion = localStorage.getItem('app_version');
      
      if (cachedVersion !== APP_VERSION) {
        localStorage.setItem('app_version', APP_VERSION);
        sessionStorage.clear();
        
        // Принудительное обновление только если это WebApp
        if (window.Telegram?.WebApp) {
          window.location.reload(true);
        }
      }
    }
    
    // Добавляем параметр версии ко всем запросам
    function cacheBuster(url) {
      return url.includes('?') 
        ? `${url}&v=${APP_VERSION}`
        : `${url}?v=${APP_VERSION}`;
    }
  </script>
</head>
<body>
  <script>
    checkCache();
    
    // Проверка Telegram WebApp API
    const result = `Telegram: ${!!window.Telegram}\nWebApp: ${!!window.Telegram?.WebApp}`;
    
    // Если это WebApp - показываем в интерфейсе, иначе alert
    if (window.Telegram?.WebApp) {
      document.body.innerHTML = `
        <h1>Telegram WebApp Cache Test</h1>
        <pre>${result}</pre>
        <p>Version: ${APP_VERSION}</p>
        <p>Last loaded: ${new Date().toLocaleString()}</p>
      `;
    } else {
      alert(result + `\nVersion: ${APP_VERSION}`);
    }
    
    // Пример использования cacheBuster
    console.log('Пример запроса с кэш-бастером:', cacheBuster('https://api.example.com/data'));
  </script>
</body>
</html>
